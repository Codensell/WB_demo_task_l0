## Демонстрационный сервис написанный на Go с использованием Kafka и PostgreSQL

Сервис принимает заказы из Kafka, сохраняет их в PostgreSQL, кладёт в память (кэш) и отдаёт через HTTP-API и простую HTML-страницу. При рестарте кэш заполняется из БД.

#### Стек

- Go + стандартная библиотека (net/http, html/template).

- Kafka. Топик: orders. Порт для клиента: localhost:9092.

- PostgreSQL

- Docker Compose для локального запуска всего стенда.

#### Архитектура

- Консюмер Kafka: читает сообщения, парсит JSON → записывает в БД → обновляет кэш → коммитит сообщение. На ошибке БД не коммитит, чтобы сообщение приехало повторно после восстановления.

- Репозиторий PostgreSQL выдает 4 таблицы; запись заказ+доставка+оплата и полная перезапись списка товаров в транзакции.

- Заполнение кеша при старте: грузит все order_uid из БД и подтягивает их полностью. При промахе — читает из БД и кладёт обратно в map.

- HTTP/API и HTML: эндпоинт GET /order/{uid} (JSON) и страница /view?order_uid=... с шаблоном. Корневая / — форма ввода UID.

#### Модель

- Поле order_uid — ключ. Остальные поля соответствуют model.json. Пример валидного заказа для теста лежит в репозитории: data/model.json.

#### Структура проекта (главные директории)

- internal/broker — Kafka consumer.

- internal/storage/postgres — репозиторий БД.

- internal/cache — кэш.

- internal/api — роуты/обработчики.

- internal/templates — index.html (форма) и view.html (представление заказа).

- cmd/app/main.go — точка входа: сборка зависимостей, запуск консюмера, HTTP-сервера.

#### Запуск программы

- Запускаем скрипт dev.sh - ./dev.sh
- Открываем второй терминал и запускаем Kafka producer - kafka-console-producer --bootstrap-server localhost:9092 --topic orders
- Вставить любой валидный json запрос
- Убедиться, что заказ отображается на странице localhost:8081
- Проверка обновления значений (upsert). Взять тот же заказ, но поменять любое значение и проверить что информация о заказе обновилась
- Сделать рестарт контейнера и восстановить страницу с последним введеным номером заказа - будет отображаться тот же заказ взятый из кеша
- Отправить невалидное значение в kafka producer, чтобы удостовериться в работе валидатора